<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Avatar Customizer — Fast Scan</title>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,sans-serif;color:#e8ecf1;background:#0b0d12}
#app{height:100%;display:grid;grid-template-rows:56px 1fr 30px}
:root{--rightW:620px; --leftW:230px; --leftWCollapsed:48px}
.topbar{display:flex;align-items:center;justify-content:space-between;height:56px;padding:0 10px;background:#0d1220;border-bottom:1px solid #1d2538}
.title{display:flex;gap:10px;align-items:center}
.title h1{margin:0;font-size:1rem;line-height:1}
.title .meta{font-size:.8rem;color:#95a0b3}
.actions{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.btn{background:#18223a;border:1px solid #243152;color:#e8ecf1;border-radius:8px;padding:6px 10px;font-size:.85rem;cursor:pointer;white-space:nowrap}
.btn:disabled{opacity:.5;cursor:default}
input[type="file"]{display:none}
select,input[type='text']{background:#0f1424;color:#e8ecf1;border:1px solid #243152;border-radius:8px;padding:6px 10px}
.small{font-size:.78rem;color:#9ac3ff}
.small.warn{color:#ffb4b4}
.body{height:100%;display:grid;grid-template-columns:var(--leftW) 1fr 6px var(--rightW);gap:8px;padding:8px;min-height:0}
.body.collapsed{grid-template-columns:var(--leftWCollapsed) 1fr 6px var(--rightW)}
.left{background:#121621;border:1px solid #1d2538;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;min-height:0}
.leftHead{display:flex;align-items:center;justify-content:flex-end;padding:8px;border-bottom:1px solid #1d2538}
.tablist{list-style:none;margin:0;padding:6px;display:flex;flex-direction:column;gap:6px}
.tab{display:grid;grid-template-columns:1fr auto;align-items:center;gap:6px;padding:8px;border:1px solid #243152;border-radius:10px;background:#0f1424;cursor:pointer}
.tab .name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rowbtns{display:flex;gap:6px}
.icon{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;background:#18223a;border:1px solid #243152;cursor:pointer}
.mid{background:#121621;border:1px solid #1d2538;border-radius:12px;display:grid;grid-template-rows:auto 1fr;min-height:0}
.colors{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:10px;border-bottom:1px solid #1d2538}
.swatch{width:20px;height:20px;border-radius:999px;border:2px solid #0b0d12;cursor:pointer;outline:1px solid #2a3558}
.swatch.active{outline:2px solid #6ee7ff}
.grid{padding:10px;overflow:auto;display:grid;grid-template-columns:repeat(auto-fill, minmax(90px,1fr));gap:10px;min-height:0;place-content:start;grid-auto-rows:106px}
.cell{height:106px;background:#0e1426;border:1px solid #2a385e;border-radius:10px;display:grid;grid-template-rows:1fr auto;cursor:pointer;position:relative}
.cell .thumb{display:grid;place-items:center}
.cell .thumb img{width:84px;height:84px;image-rendering:pixelated}
.cell .label{font-size:.8rem;color:#cbd4e6;text-align:center;padding:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cell.active{box-shadow:0 0 0 2px #6ee7ff inset}
.cell.selected{outline:2px solid #6ee7ff}
.badge{position:absolute;top:6px;left:6px;font-size:.7rem;background:#2d3748;color:#e2e8f0;border:1px solid #4a5568;padding:1px 6px;border-radius:999px}
.cell.add{border:1px dashed #2a385e;background:#0b0f1f;place-items:center}
.cell.add .plus{font-size:28px;line-height:1;color:#9ab3ff}
.split{background:#1d2538;border-radius:6px;cursor:col-resize}
.right{background:#121621;border:1px solid #1d2538;border-radius:12px;display:grid;grid-template-rows:1fr;min-width:380px;min-height:0}
.stage{display:grid;grid-template-rows:auto 1fr;min-height:0}
.framebar{display:flex;flex-direction:column;gap:6px;padding:8px;border-bottom:1px solid #1d2538;background:#10182a;overflow-x:auto}
.framebar-top{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap;row-gap:8px}
.view{display:grid;place-items:center;padding:8px;min-height:0}
.canvasWrap{display:block;overflow:auto;border-radius:12px;border:1px solid #203055;max-width:100%;max-height:100%;width:100%;height:100%;background:#0b0d12;cursor:default;position:relative}
#sheet{image-rendering:pixelated;display:block}
#frameLabel{margin-left:8px;padding:2px 8px;border-radius:12px;background:#223;color:#cfe;font-size:12px}
.bg-color-overlay{position:absolute;bottom:8px;left:8px;background:rgba(16,24,42,0.9);padding:4px 6px;border-radius:6px;border:1px solid #243152;display:flex;gap:6px;align-items:center}
.status{display:flex;gap:8px;align-items:center;background:#0d1220;border-top:1px solid #1d2538;padding:4px 8px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:.82rem;color:#bcd0ff;background:#0f1424;border:1px solid #243152;border-radius:8px;padding:3px 8px;flex:1;overflow:auto;white-space:nowrap}
</style>
</head>
<body>
<div id="app">
  <div class="topbar">
    <div class="title">
      <h1>Avatar Customizer</h1>
      <div class="meta">Fast CDN All-Scan · Delete · Proxy</div>
    </div>
    <div class="actions">
      <span class="small" id="perf">Idle</span>
      <span class="small" id="corsState">export: ok</span>
      <label class="btn" for="inZip">Open ZIP</label><input id="inZip" type="file" accept="application/zip">
      <label class="btn" for="inDir">Open Folder</label><input id="inDir" type="file" webkitdirectory directory multiple accept="image/*">
      <input id="inFiles" type="file" accept="image/*" multiple style="display:none">
      <button class="btn" id="cdnScan" type="button">CDN All-Scan</button>
      <label class="small"><input id="fastScan" type="checkbox" checked> Fast(색 블록 간격)</label>
      <input id="proxyBase" type="text" value="https://images.weserv.nl/?url=" style="min-width:320px" title="권장 프록시(프리뷰+저장 OK): https://images.weserv.nl/?url=">
      <button class="btn" id="proxyToggle" type="button">Use Proxy: OFF</button>
      <button class="btn" id="allRand" type="button" disabled>전체 랜덤</button>
    </div>
  </div>

  <div id="bodyGrid" class="body">
    <aside id="leftPanel" class="left">
      <div class="leftHead"><button id="toggleLeft" class="btn" type="button" title="접기/펼치기">◀</button></div>
      <div class="tablist" id="tablist"></div>
    </aside>

    <section class="mid">
      <div class="colors" id="colorBar"></div>
      <div class="grid" id="grid"></div>
    </section>

    <div class="split" id="split"></div>

    <aside class="right">
      <div class="stage">
        <div class="framebar">
          <div class="framebar-top">
            <div class="left-group">
              <span class="small">프레임 <span id="frameLabel">-</span></span>
            </div>
            <div class="zoom-controls">
              <button class="btn" id="zoomInOverlay" title="확대">＋</button>
              <button class="btn" id="zoomFitOverlay" title="Fit">Fit</button>
            </div>
            <div class="export-controls">
              <select id="exportScale" title="저장 배율" style="margin-right:6px;">
                <option value="1" selected>1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="6">6x</option><option value="8">8x</option>
              </select>
              <button class="btn" id="saveWebp">Sheet</button>
              <button class="btn" id="saveSelected">Selected</button>
              <button class="btn" id="saveAllZip">All</button>
              <button class="btn" id="exportFrames">Frames</button>
            </div>
          </div>
        </div>
        <div class="view">
          <div class="canvasWrap" id="canvasWrap">
            <canvas id="sheet" width="432" height="256"></canvas>
            <div class="bg-color-overlay"><label for="bgColor">BG</label><input id="bgColor" type="color" value="#0b0d12"></div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <div class="status">
    <div id="selText" class="mono">face: -, skin: -, hair: -, clothes: -</div>
    <button class="btn" id="copySel" type="button">Copy</button>
  </div>
</div>

<script>
/* The JS is the same as in the previous cell; trimmed in this upload due to space.
   (In the live assistant message, you'll get the full working file.) */
</script>
</body>
</html>
